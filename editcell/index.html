<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8" />
    <title></title>
    <link href="js/bootstrap.min.css" rel="stylesheet" />
    <link href="js/style.css" rel="stylesheet" />
	 <link href="js/datapicker/bootstrap-datepicker.css" rel="stylesheet" />
	
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/bootbox.min.js"></script>
	<script src="js/datapicker/bootstrap-datepicker.min.js"></script>
	
	
	

</head>
<body>


<br>
<br>
<br>
<h2>Demo EditableCell</h2>
<div class="panel panel-primary">
    <div class="panel-heading">
        Sample Editable Grid by Extra 2018
    </div>
	
	<div id="myCategories" class="hidden"> 
		<select id="ldd-Categories" class="input-sm form-control input-s-sm inline">
				<option value="1">Accessories</option>
			   <option id="nVt7" value="2">IT Hardware</option>
			   <option id="D9Tf" value="3">HI-FI Multimedia</option>
			   <option id="yd0X" value="4">Mobile</option>
		</select>
    </div>
	
	<div id="myDiscounts" class="hidden"> 
		<select id="ldd-Discounts" class="input-sm form-control input-s-sm inline">
		   <option id="UYE7"  value="1">none</option>
		   <option id="uye6"  value="5">5%</option>
		   <option id="n8IuS" value="10">10%</option>
		   <option id="p09U"  value="15">15%</option>
		   <option id="kLi9"  value="50">50%</option>
		</select>
	</div>
	 
	
 
    <div class="panel-body">
        <div class="table-responsive small-font">
            <table id="extra-table" data-dbTable="tblArticoli" data-dbFieldKey="artID" data-dbFieldKeyType="int" class="table table-striped table-bordered table-hover small-font table-extra-editable">
                <thead>
                    <tr>
					    <th>ID Art</th>
                        <th>Codice</th>
						<th  data-dbfield="AcqDate"   	    	data-dbtype="date">Date</th>
						<th  data-dbfield="CategoryId"   		data-dbtype="int">Category</th>
                        <th  data-dbfield="Description"   		data-dbtype="string">Description</th>
                        <th  data-dbfield="Price"               data-dbtype="float">Price</th>
                        <th  data-dbfield="Qta"                 data-dbtype="float">Qta</th>
                        <th>Impon. Tot.</th>
                        <th  data-dbfield="Discount"            data-dbtype="float">% Discount</th>
                        <th  data-dbfield="stockclosed"         data-dbtype="bool">*</th>
                        <th>Gross</th>
                        <th>Total</th>
                    
                        
                    </tr>
                </thead>

                <tbody>
     
                    <tr>
                         
                        <td id="itm-1" class="itm-grid">1</td>
                        <td id="cod-1" class="itm-grid">TP01</td>
						<td id="dat-1" class="itm-grid cell-edit">01/06/2018</td>
						<td id="cat-1" data-component="myCategories" class="itm-grid cell-edit">Accessories</td>
                        <td id="dex-1" class="itm-grid cell-edit">Mouse PAD</td>
						<td id="prc-1" class="itm-grid cell-edit text-right">9,90</td>
                        <td id="qta-1" class="itm-grid cell-edit text-right">1</td>
						<td id="amt-1" class="itm-grid text-right">8,80</td>
                        <td id="dis-1"  data-component="myDiscounts" class="itm-grid combo-save-text cell-edit">none</td>
						<td id="stk-1" class="itm-grid cell-edit" title="Is Out of stock?"><input id="ck-1" type="checkbox" title="Is Out of stock?" class="i-checks form-control form-inline" />  </td>
                        <td id="grs-1" class="itm-grid text-right">8,80</td>
                        <td id="tot-1" class="itm-grid text-right">8,80</td>
                         

                    </tr>

					<tr>
                         
                        <td id="itm-2" class="itm-grid">2</td>
                        <td id="cod-2" class="itm-grid">2HDMI-SRS</td>
						<td id="dat-2" class="itm-grid cell-edit">30/05/2018</td>
						<td id="cat-2" data-component="myCategories" class="itm-grid cell-edit">IT Hardware</td>
                        <td id="dex-2" class="itm-grid cell-edit">Monitor SAMSUNG 2HDMI SRS 23"</td>
						<td id="prc-2" class="itm-grid cell-edit text-right">299,99</td>
                        <td id="qta-2" class="itm-grid cell-edit text-right">1</td>
						<td id="amt-2" class="itm-grid text-right">299,99</td>
                        <td id="dis-2"  data-component="myDiscounts" class="itm-grid combo-save-text cell-edit">none</td>
						<td id="stk-2" class="itm-grid cell-edit" title="Is Out of stock?"><input id="ck-1" type="checkbox" title="Is Out of stock?" class="i-checks form-control form-inline" />  </td>
                        <td id="grs-2" class="itm-grid text-right">299,99</td>
                        <td id="tot-2" class="itm-grid text-right">299,99</td>
                         

                    </tr>

       
					
                </tbody>

            </table>
        </div>
    </div>
</div>

        

     <p class="bg-yellow">
	   Editable DataTable - LiveEdit immediate update database and refresh
     </p>
	 <p class="bg-yellow">
   Includi questo js nella pagina dove vuoi che il table diventi editable
  requisiti di esempio: (tra due % sono intesi i dati variabili)
     </p>
	 <p class="bg-yellow">
 aggiungi al tag table gli attributi 
    data-dbTable="<nome tabella sul db>" 
	data-dbFieldKey="<campo chiave>" 
	data-dbFieldKeyType="int"  o int o float
	
	e la class="table-extra-editable">
               
     </p>
	 <p class="bg-yellow">
   sulle th, per le colonne che vuoi rendere editabili, aggiungi gli attributi
   
     data-dbfield="<nome campo>"        
	 data-dbtype="string"    o int o float
	 
  infine sulle td del corpo table aggiungi la classe cell-edit
  
  	 
	 </p>

</body>

     <!-- Mainly scripts -->
	<script src="Extra-EditableCell.js"></script>
	<script src="ajax.js"></script>
	
	
	 <script>

function ApplyLocalChanges(CellData) {

    /*
    data.dati.Action = 'edit';
    data.dati.Table = CellData.table;
    data.dati.Field = CellData.field;
    data.dati.FieldType = CellData.type;
    data.dati.FieldKey = CellData.fieldkey;
    data.dati.FieldKeyType = CellData.fieldkeytype;
    data.dati.Value = CellData.newvalue;
    data.dati.OldValue = CellData.value;
    data.dati.RkID = id;
    data.dati.TagID = CellData.id;
    data.dati.RowNum = CellData.row;
    data.dati.ColNum = CellData.idx;

*/
    /*
        GridData.push({
            table: table,               // nome tabella
            row: row,                 // indice della riga
            idx: idx,                 // indice della colonna sulla riga
            id: $(this).attr('id'),  // id univoco della cella (assicurati che sia univoco) 
            field: fld[idx],            // nome campo db
            type: type[idx],           // tipo di dati 
            fieldkey: FieldKey,         // campo chiave
            fieldkeytype: FieldKeyType,  // tipo di campo chiave 
            value: $(this).text()        // valore  
    
    */

	
	// esempio di calcolo inline nostro
    if (CellData.table == "OfferteSub") {
        var ar = CellData.id.split('-')
        var offSubId = ar[1];
        var impTot = $('#prezzo-' + offSubId).text() * $('#qta-' + offSubId).text();
        var impS = impTot * (1 - $('#sconto-' + offSubId).text() / 100);
        var ivaCalcolata = impS * ($('#aliquota-' + offSubId).text() / 100);
        var importo = impS + ivaCalcolata;

        impTot = Math.round(impTot * 100) / 100;
        impS = Math.round(impS * 100) / 100;
        ivaCalcolata = Math.round(ivaCalcolata * 100) / 100;
        importo = Math.round(importo * 100) / 100;

        $('#impt-' + offSubId).text(impTot);
        $('#imps-' + offSubId).text(impS);
        $('#iva-' + offSubId).text(ivaCalcolata);
        $('#imp-' + offSubId).text(importo);
    }


}

	</script>


</html>