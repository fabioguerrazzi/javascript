<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8" />
    <title></title>
    <link href="js/bootstrap.min.css" rel="stylesheet" />
    <link href="js/style.css" rel="stylesheet" />
	
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/bootbox.min.js"></script>
	

</head>
<body>


<br>
<br>
<br>
<h2>Demo EditableCell</h2>
<div class="panel panel-primary">
    <div class="panel-heading">
        Esempio Editable Grid by Extra 2018
    </div>
    <div class="panel-body">
        <div class="table-responsive small-font">
            <table data-dbTable="tblArticoli" data-dbFieldKey="artID" data-dbFieldKeyType="int" class="table table-striped table-bordered table-hover small-font table-extra-editable">
                <thead>
                    <tr>
					    <th >ID Art</th>
                        <th >Codice</th>
                        <th  data-dbfield="Descrizione"   data-dbtype="string">Descrizione</th>
                        <th  data-dbfield="Prezzo"              data-dbtype="float">Prezzo</th>
                        <th  data-dbfield="Qta"                      data-dbtype="float">Qta</th>
                        <th>Impon. Tot.</th>
                        <th  data-dbfield="Sconto"                      data-dbtype="float">Sconto </th>
                        <th>Impon. Sc.</th>
                        <th  data-dbfield="IVAPerc"                    data-dbtype="float">Iva %</th>
                        <th>Imposta</th>
                        <th>Totale</th>
                        
                      
                        
                    </tr>
                </thead>

                <tbody>
     
                    <tr>
                         
                        <td id="id-1" class="itm-grid">1/td>
                        <td id="code-1" data-type="date" class="itm-grid">TP01</td>
                        <td id="dex-1" class="itm-grid cell-edit">Tappetino Mouse</td>
                        <td id="prezzo-1" class="itm-grid cell-edit text-right">1.40</td>
                        <td id="qta-1" class="itm-grid cell-edit text-right">2</td>
                        <td id="impt-1" class="itm-grid text-right">1525</td>
                        <td id="sconto-1" class="itm-grid cell-edit text-right">0</td>
                        <td id="imps-1" class="itm-grid text-right  cell-edit">1125</td>
                        <td id="aliquota-1" class="itm-grid text-right  cell-edit">20</td>
                        <td id="iva-1" class="itm-grid text-right">215</td>
                        <td id="imp-1" class="itm-grid text-right">1235</td>
                         

                    </tr>

       <tr>
                         
                        <td id="id-2" class="itm-grid">2</td>
                        <td id="code-2" data-type="date" class="itm-grid">TP02</td>
                        <td id="dex-2" class="itm-grid cell-edit">Tastiera 102 tasti IT</td>
                        <td id="prezzo-2" class="itm-grid cell-edit text-right">12.2</td>
                        <td id="qta-2" class="itm-grid cell-edit text-right">1</td>
                        <td id="impt-2" class="itm-grid text-right">12.20</td>
                        <td id="sconto-2" class="itm-grid cell-edit text-right">0</td>
                        <td id="imps-2" class="itm-grid text-right  cell-edit">12.20</td>
                        <td id="aliquota-2" class="itm-grid text-right  cell-edit">20</td>
                        <td id="iva-2" class="itm-grid text-right">14.40</td>
                        <td id="imp-2" class="itm-grid text-right">16.60</td>
                         

                    </tr>

       <tr>
                         
                        <td id="id-3" class="itm-grid">3</td>
                        <td id="code-3" data-type="date" class="itm-grid">TP03</td>
                        <td id="dex-3" class="itm-grid cell-edit">Monitor 12" ASUS</td>
                        <td id="prezzo-3" class="itm-grid cell-edit text-right">84</td>
                        <td id="qta-3" class="itm-grid cell-edit text-right">2</td>
                        <td id="impt-3" class="itm-grid text-right">84</td>
                        <td id="sconto-3" class="itm-grid cell-edit text-right">0</td>
                        <td id="imps-3" class="itm-grid text-right  cell-edit">84</td>
                        <td id="aliquota-3" class="itm-grid text-right  cell-edit">20</td>
                        <td id="iva-3" class="itm-grid text-right">86</td>
                        <td id="imp-3" class="itm-grid text-right">88.20</td>
                         

                    </tr>
					
                </tbody>

            </table>
        </div>
    </div>
</div>

        

     <p class="bg-yellow">
	   Handler per il LiveEdit di un oggetto Table.
     </p>
	 <p class="bg-yellow">
   Includi questo js nella pagina dove vuoi che il table diventi editable
  requisiti di esempio: (tra due % sono intesi i dati variabili)
     </p>
	 <p class="bg-yellow">
 aggiungi al tag table gli attributi 
    data-dbTable="<nome tabella sul db>" 
	data-dbFieldKey="<campo chiave>" 
	data-dbFieldKeyType="int"  o int o float
	
	e la class="table-extra-editable">
               
     </p>
	 <p class="bg-yellow">
   sulle th, per le colonne che vuoi rendere editabili, aggiungi gli attributi
   
     data-dbfield="<nome campo>"        
	 data-dbtype="string"    o int o float
	 
  infine sulle td del corpo table aggiungi la classe cell-edit
  
  	 
	 </p>

</body>

     <!-- Mainly scripts -->
	<script src="Extra-EditableCell.js"></script>
	<script src="ajax.js"></script>
	
	
	 <script>

function ApplyLocalChanges(CellData) {

    /*
    data.dati.Action = 'edit';
    data.dati.Table = CellData.table;
    data.dati.Field = CellData.field;
    data.dati.FieldType = CellData.type;
    data.dati.FieldKey = CellData.fieldkey;
    data.dati.FieldKeyType = CellData.fieldkeytype;
    data.dati.Value = CellData.newvalue;
    data.dati.OldValue = CellData.value;
    data.dati.RkID = id;
    data.dati.TagID = CellData.id;
    data.dati.RowNum = CellData.row;
    data.dati.ColNum = CellData.idx;

*/
    /*
        GridData.push({
            table: table,               // nome tabella
            row: row,                 // indice della riga
            idx: idx,                 // indice della colonna sulla riga
            id: $(this).attr('id'),  // id univoco della cella (assicurati che sia univoco) 
            field: fld[idx],            // nome campo db
            type: type[idx],           // tipo di dati 
            fieldkey: FieldKey,         // campo chiave
            fieldkeytype: FieldKeyType,  // tipo di campo chiave 
            value: $(this).text()        // valore  
    
    */

	
	// esempio di calcolo inline nostro
    if (CellData.table == "OfferteSub") {
        var ar = CellData.id.split('-')
        var offSubId = ar[1];
        var impTot = $('#prezzo-' + offSubId).text() * $('#qta-' + offSubId).text();
        var impS = impTot * (1 - $('#sconto-' + offSubId).text() / 100);
        var ivaCalcolata = impS * ($('#aliquota-' + offSubId).text() / 100);
        var importo = impS + ivaCalcolata;

        impTot = Math.round(impTot * 100) / 100;
        impS = Math.round(impS * 100) / 100;
        ivaCalcolata = Math.round(ivaCalcolata * 100) / 100;
        importo = Math.round(importo * 100) / 100;

        $('#impt-' + offSubId).text(impTot);
        $('#imps-' + offSubId).text(impS);
        $('#iva-' + offSubId).text(ivaCalcolata);
        $('#imp-' + offSubId).text(importo);
    }


}

	</script>


</html>